<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" /> 
  <title>Schooz in BiwaScheme</title>
</head>
<body>

<p/>
Scheme console:
<div id="bs-console"></div>

<p/>
Schooz div:
<div id="schoozMain"></div>

<p/>
Script tag with Scheme inside:
<script src="biwascheme/biwascheme.js">
(display "hello, world! Scheme is working, up in this piece\n")
</script>

<p/>
Script tag that loads Scheme from URL:
<script>
// first define schooz JS functions
var schoozStash = function(xml) { document.getElementById("schoozMain").innerHTML = xml; };
var schoozBind = function(id,func) { document.getElementById(id).onclick = func; };
var schoozReveal = function() { };

// now do tests
  var console_log = function(e) { puts(e); };
  var dummy_log = function(e) { };
  console_log ("hi there, logging function seems to be working ");
  dummy_log ("you schmuck ");  // shouldn't appear
  var intp = new BiwaScheme.Interpreter (dummy_log);
  var the_url = "schooz.scm";
  var xhr = new XMLHttpRequest();
  xhr.onreadystatechange = function() {
    if (xhr.readyState == 4) {
      console_log ("loaded Scheme (" + xhr.responseText.length + " bytes)");
      intp.evaluate (xhr.responseText, function(e) { console_log("evaluated Scheme: " + e); } );
      intp.evaluate ("schooz:version", function(e) { console_log("evaluated schooz:version = " + e); } );
      intp.evaluate ("(js-call (js-closure (lambda () \"crazy\")))", function(e) { console_log("crazy function-wrapping is working if the word 'crazy' appears here: " + e); } );
      console_log ("Now going to try a popup window...")
      intp.evaluate ("(js-call (js-eval \"( function() { alert('hello, this is a popup window from BiwaScheme'); } )\"))", dummy_log);
      console_log ("...OK, hopefully you got that")
    }
  };
  xhr.open("GET", the_url, true);
  xhr.send(null);
</script>

</body>
</html>
